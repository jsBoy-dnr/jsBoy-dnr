/* eslint-disable guard-for-in */
/* eslint-disable camelcase */
/* eslint-disable no-undefined */
var page_data = {
    'Бурятия': {
        'specialization': 'Кадровое Администирование',
        'company': 'АО «Промтранс»',
        'list': [{
            'name': 'Участок по производству рештаков',
            'list': [{
                'name': 'Участок по производству рештаков',
                'list': [{
                    'name': 'Участок по производству рештаков',

                },
                {
                    'name': 'Участок по производству рештаков',

                },
                {
                    'name': 'Участок по производству рештаков',

                }
                ]
            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            }
            ]
        },
        {
            'name': 'КЛИК',
            'top_icon': '/local/templates/suek.new/images/icons/icon-4.svg',
            'company_info': 'ООО \'Бородинский РМЗ\'',
            'employees': 4120,
            'address': '662200, г. Березовский, ул. Лосиная роща, д. 1.',
            'photo': '/local/templates/suek.new/images/happy_b_day_image19.png',
            'fio': 'Добролюбов Владимир Николаевич',
            'posiiton': 'Генеральный директор предприятия',
            'title': 'Отдел информационного, IT-поддержки и документационного обеспечения по великому управлению главного офиса компании',
            'employees_list': [{
                'name': 'Глава подразделения',
                'list': [{
                    'photo': '/local/templates/suek.new/images/step_author8_01.png',
                    'title': 'Зельчинская Маргарита Потаповна',
                    'txt': 'Заместитель Директора по персоналу и администрации (региональные вопросы работы с персоналом)'
                }]
            },
            {
                'name': 'Сотрудники',
                'list': [{
                    'photo': '/local/templates/suek.new/images/phonebook_image5.png',
                    'title': 'Вершинский Вениаимин Павлович',
                    'txt': 'Лаборант 1 категории'
                },
                {
                    'photo': '/local/templates/suek.new/images/phonebook_image5.png',
                    'title': 'Вершинский Вениаимин Павлович',
                    'txt': 'Лаборант 1 категории'
                },
                {
                    'photo': '/local/templates/suek.new/images/phonebook_image5.png',
                    'title': 'Вершинский Вениаимин Павлович',
                    'txt': 'Лаборант 1 категории'
                },
                {
                    'photo': '/local/templates/suek.new/images/phonebook_image5.png',
                    'title': 'Вершинский Вениаимин Павлович',
                    'txt': 'Лаборант 1 категории'
                },
                {
                    'photo': '/local/templates/suek.new/images/phonebook_image5.png',
                    'title': 'Вершинский Вениаимин Павлович',
                    'txt': 'Лаборант 1 категории'
                },
                {
                    'photo': '/local/templates/suek.new/images/phonebook_image5.png',
                    'title': 'Вершинский Вениаимин Павлович',
                    'txt': 'Лаборант 1 категории'
                },
                {
                    'photo': '/local/templates/suek.new/images/phonebook_image5.png',
                    'title': 'Вершинский Вениаимин Павлович',
                    'txt': 'Лаборант 1 категории'
                },
                {
                    'photo': '/local/templates/suek.new/images/phonebook_image5.png',
                    'title': 'Вершинский Вениаимин Павлович',
                    'txt': 'Лаборант 1 категории'
                },
                {
                    'photo': '/local/templates/suek.new/images/phonebook_image5.png',
                    'title': 'Вершинский Вениаимин Павлович',
                    'txt': 'Лаборант 1 категории'
                },
                {
                    'photo': '/local/templates/suek.new/images/phonebook_image5.png',
                    'title': 'Вершинский Вениаимин Павлович',
                    'txt': 'Лаборант 1 категории'
                }
                ]
            }
            ]
        },
        {
            'name': 'Участок по производству рештаков',
            'list': [{
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            }
            ]
        }
        ]
    },
    'Забайкалье': {
        'specialization': 'Кадровое Администирование',
        'company': 'АО «Промтранс»',
        'list': [{
            'name': 'Участок по производству рештаков',
            'list': [{
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            }
            ]
        }]
    },
    'Красноярский край': {
        'specialization': 'Кадровое Администирование',
        'company': 'АО «Промтранс»',
        'list': [{
            'name': 'Участок по производству рештаков',
            'list': [{
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            }
            ]
        }]
    },
    'Кузбасс': {
        'specialization': 'Кадровое Администирование',
        'company': 'АО «Промтранс»',
        'list': [{
            'name': 'Участок по производству рештаков',
            'list': [{
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            }
            ]
        }]
    },
    'Москва': {
        'specialization': 'Кадровое Администирование',
        'company': 'АО «Промтранс»',
        'list': [{
            'name': 'Участок по производству рештаков',
            'list': [{
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            }
            ]
        }]
    },
    'Мурманск': {
        'specialization': 'Кадровое Администирование',
        'company': 'АО «Промтранс»',
        'list': [{
            'name': 'Участок по производству рештаков',
            'list': [{
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            }
            ]
        }]
    },
    'Приморье': {
        'specialization': 'Кадровое Администирование',
        'company': 'АО «Промтранс»',
        'list': [{
            'name': 'Участок по производству рештаков',
            'list': [{
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            }
            ]
        }]
    },
    'Хакасия': {
        'specialization': 'Кадровое Администирование',
        'company': 'АО «Промтранс»',
        'list': [{
            'name': 'Участок по производству рештаков',
            'list': [{
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            }
            ]
        }]
    },
    'Хабаровский край': {
        'specialization': 'Кадровое Администирование',
        'company': 'АО «Промтранс»',
        'list': [{
            'name': 'Участок по производству рештаков',
            'list': [{
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            },
            {
                'name': 'Участок по производству рештаков',

            }
            ]
        }]
    }
};

function openSumMenu(dom_obj) {
    if (!$(dom_obj).parent().find('.popup_win_body_item_name_submenu:first').is(':visible')) {
        $(dom_obj).find('.popup_win_body_item_name > img').attr('src', '/local/templates/suek.new/images/icons/icon-3.svg');
        $(dom_obj).parent().find('.popup_win_body_item_name_submenu:first').show();
    } else {
        $(dom_obj).find('.popup_win_body_item_name > img').attr('src', '/local/templates/suek.new/images/icons/icon-2.svg');
        $(dom_obj).parent().find('.popup_win_body_item_name_submenu:first').hide();
    }

    $('#popup_win_body_c').nanoScroller();
    $('#popup_win_body_c').on('update', function (e) {
        uiUpdateArrowConnector();
    });

    uiUpdateArrowConnector();
}

/**
 * @example g_get_correct_str_suffix(10, 'день','дня', 'дней')
 */
function g_get_correct_str_suffix(num, str1, str2, str3) {
    var val = num % 100;

    if (val > 10 && val < 20) {
        return str3;
    } else {
        val = num % 10;
        if (val === 1) {
            return str1;
        } else if (val > 1 && val < 5) {
            return str2;
        } else {
            return str3;
        }
    }
}

var drawConnector = function (pos1, pos2, arrowLeft) {
    var dStrLeft =
        'M' +
        (pos1.x) + ',' + (pos1.y) + ' ' +
        'C' +
        (pos1.x + 100) + ',' + (pos1.y) + ' ' +
        (pos2.x - 100) + ',' + (pos2.y) + ' ' +
        (pos2.x) + ',' + (pos2.y);
    arrowLeft.setAttribute('d', dStrLeft);
};

function uiUpdateArrowConnector() {
    if (!$('.popup_win_body_item_name_selected').length) {
        return;
    }

    drawConnector({
        x: $('.popup_win_body_item_name_selected').offset().left - $('#popup_win_body_c').offset().left + $('.popup_win_body_item_name_selected').width() + 20,
        y: $('.popup_win_body_item_name_selected').offset().top - $('#popup_win_body_c').offset().top + $('.popup_win_body_item_name_selected').height() / 2
    }, {
        x: $('#popup_win_right_info_c').offset().left - $('#popup_win_body_c').offset().left - 20,
        y: $('#popup_win_right_info_c').offset().top - $('#popup_win_body_c').offset().top + $('#popup_win_right_info_c').height() / 2
    },
        document.querySelector('#arrowLeft')
    );
}

function hideInfo() {
    $('#popup_win_right_info_c').hide();
    document.querySelector('#arrowLeft').setAttribute('d', '');

    $('.popup_win_body_item_name_c_havesubmenu .popup_win_body_item_name').removeClass('popup_win_body_item_name_selected');
    $('.popup_win_body_item_name_c_havesubmenu .popup_win_body_item_name').each(function () {
        $(this).find('img:first').attr('src', '/local/templates/suek.new/images/icons/icon-1.svg');
    });
}

function showInfo(dom_obj) {
    var obj = JSON.parse(unescape($(dom_obj).data('item')));

    $('.popup_win_body_item_name_c_havesubmenu .popup_win_body_item_name').removeClass('popup_win_body_item_name_selected');
    $('.popup_win_body_item_name_c_havesubmenu .popup_win_body_item_name').each(function () {
        $(this).find('img:first').attr('src', '/local/templates/suek.new/images/icons/icon-1.svg');
    });

    $(dom_obj).find('.popup_win_body_item_name:first').addClass('popup_win_body_item_name_selected');
    $(dom_obj).find('.popup_win_body_item_name:first').find('img:first').attr('src', '/local/templates/suek.new/images/icons/icon-1-white.svg');

    $('#popup_win_right_info_header > img').attr('src', obj.top_icon);
    $('#popup_win_right_info_header > span').html(obj.company_info);

    var ss = '';
    ss += '<li>' + obj.employees + ' ' + g_get_correct_str_suffix(obj.employees, 'сотрудник', 'сотрудника', 'сотрудников') + '</li>';
    ss += '<li>' + obj.address + '</li>';

    $('#popup_win_right_info_header_list').html(ss);

    $('#popup_win_right_info_user_info_fio').html(obj.fio);
    $('#popup_win_right_info_user_info_position').html(obj.posiiton);
    $('#popup_win_right_info_user_info > img').attr('src', obj.photo);

    $('#popup_win_right_footer_title').html(obj.title);

    ss = '';

    for (var p in obj.employees_list) {
        ss += '<div class="popup_win_right_footer_list_item">' + p.name + '</div>';

        for (var p2 in p.list) {
            ss += '<div class="popup_win_right_footer_list_item2">';

            ss += '<img src="' + p2.photo + '" />';
            ss += '<div>';
            ss += '<div class="popup_win_right_footer_list_item2_info_1">';
            ss += p2.title;
            ss += '</div>';
            ss += '<div class="popup_win_right_footer_list_item2_info_2">';
            ss += p2.txt;
            ss += '</div>';
            ss += '</div>';

            ss += '</div>';
        }
    }

    $('#popup_win_right_footer_list').html(ss);

    $('#popup_win_right_info_c').show();

    $('#popup_win_right_info_c > div').nanoScroller({
        alwaysVisible: true
    });

    uiUpdateArrowConnector();
}

function drawItemMenu(k) {
    var ss = '';

    for (var obj in k.list) {
        let f = (obj.list !== undefined);

        ss += '<div class="popup_win_body_item">';

        // ss += '<div class="popup_win_body_item_name_c ' + (!f ? + 'popup_win_body_item_name_c_havesubmenu '+ ) : (!f ? + 'onclick="showInfo(this)" data-item="' + escape(JSON.stringify(obj)) + '"' : 'onclick="openSumMenu(this)"'+ ) + '>';
        ss += '<div class="popup_win_body_item_name_c ' + (!f ? 'popup_win_body_item_name_c_havesubmenu' : '') + '" ' + (!f ? 'onclick="showInfo(this)" data-item="' + escape(JSON.stringify(obj)) + '"' : 'onclick="openSumMenu(this)"') + '>';
        ss += '<div class="popup_win_body_item_hline"></div>';
        ss += '<div class="popup_win_body_item_name">';

        if (!f) {
            ss += '<img src="/local/templates/suek.new/images/icons/icon-1.svg" />';
        } else {
            ss += '<img src="/local/templates/suek.new/images/icons/icon-2.svg" />';
        }

        ss += '<span>' + obj.name + (f ? ' (' + obj.list.length + ')' : '') + '</span>';
        ss += '</div>';
        ss += '</div>';

        if (f) {
            ss += '<div class="popup_win_body_item_name_submenu">';
            ss += drawItemMenu(obj);
            ss += '</div>';
        }

        ss += '</div>';
    }

    return ss;
}

function menu2Change(dom_obj, key) {
    var k = page_data[key];

    $('.lk_ds_menu_2 > span').removeClass('lk_ds_menu_2_current');

    $(dom_obj).addClass('lk_ds_menu_2_current');

    $('#popup_win').css({
        'left': $(window).width(),
        'display': 'flex',
        'background': 'none'
    });

    $('#popup_win').animate({
        'left': 0
    }, 500, function () {
        $('#popup_win').css({
            'background': 'rgba(81,81,81,0.5)'
        });
    });

    $('#popup_win_body_title_1 > label').html(k.specialization);
    $('#popup_win_body_title_2 > label').html(k.company);

    $('#popup_win_body_list').html('');

    $('#popup_win_body_list').html(drawItemMenu(k));

    $('#popup_win_body_c').nanoScroller();
}

function closePopupWin() {
    $('#popup_win').hide(100);
    $('.lk_ds_menu_2 > span').removeClass('lk_ds_menu_2_current');
    hideInfo();
}

$(function () {

    $('#lk_ds_menu_2').html('');

    var ss = '';

    for (var key in page_data) {
        ss += '<span onclick="menu2Change(this,' + key + ')"> ' + key + ' < /span>';
    }

    $('#lk_ds_menu_2').html(ss);

    $(window).resize(function () {
        uiUpdateArrowConnector();
    });

    if (window.innerWidth <= 776) {
        $('#header_content_top_menu > ul').css({
            'position': 'absolute'
        });
        $('#header_content_top_menu').css({
            'height': $('#header_content_top_menu > ul').height()
        });
        slider_menu.init($('#header_content_top_menu > ul'));
    }

    $('.items-wrap').addClass('owl-carousel').owlCarousel({
        loop: true,
        margin: 0,
        nav: true,
        items: 3,
        dots: false,
        autoplay: false,
        responsive: {
            0: {
                items: 1,
                margin: 10
            },
            660: {
                items: 2,
                margin: 10
            },
            1200: {
                items: 3,
                margin: 20
            }
        }
    });

    $('#drag').addClass('owl-carousel').owlCarousel({
        loop: true,
        margin: 0,
        nav: true,
        items: 3,
        dots: false,
        autoplay: false,
        responsive: {
            0: {
                items: 1,
                margin: 10
            },
            660: {
                items: 2,
                margin: 10
            },
            1200: {
                items: 3,
                margin: 20
            }
        }
    });

});

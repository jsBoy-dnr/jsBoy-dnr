let division_info_top = {
    0: {
        LTIFR: 0.2,
        stat_months: {
            'Январь, 2020': {
                total: 35,
                legend_v1: 12,
                legend_v2: 7,
                legend_v3: 2
            },
            'Февраль, 2020': {
                total: 27,
                legend_v1: 5,
                legend_v2: 2,
                legend_v3: 0
            },
            'Март, 2020': {
                total: 43,
                legend_v1: 16,
                legend_v2: 14,
                legend_v3: 3
            },
            'Апрель, 2020': {
                total: 31,
                legend_v1: 12,
                legend_v2: 10,
                legend_v3: 1
            }
        }
    },
    1: {
        LTIFR: 0.9,
        stat_months: {
            'Май, 2020': {
                total: 25,
                legend_v1: 11,
                legend_v2: 6,
                legend_v3: 0
            },
            'Июнь, 2020': {
                total: 21,
                legend_v1: 7,
                legend_v2: 0,
                legend_v3: 1
            },
            'Июль, 2020': {
                total: 26,
                legend_v1: 10,
                legend_v2: 2,
                legend_v3: 0
            }
        }
    },
    2: {
        LTIFR: 1.2,
        stat_months: {
            'Август, 2020': {
                total: 10,
                legend_v1: 35,
                legend_v2: 15,
                legend_v3: 6
            },
            'Сентябрь, 2020': {
                total: 5,
                legend_v1: 36,
                legend_v2: 25,
                legend_v3: 18
            },
            'Октябрь, 2020': {
                total: 63,
                legend_v1: 23,
                legend_v2: 2,
                legend_v3: 10
            }
        }
    },
    3: {
        LTIFR: 1.9,
        stat_months: {
            'Ноябрь, 2020': {
                total: 19,
                legend_v1: 30,
                legend_v2: 15,
                legend_v3: 6
            },
            'Декабрь, 2020': {
                total: 5,
                legend_v1: 21,
                legend_v2: 3,
                legend_v3: 2
            },
            'Январь, 2020': {
                total: 63,
                legend_v1: 22,
                legend_v2: 3,
                legend_v3: 5
            }
        }
    },
    4: {
        LTIFR: 1.0,
        stat_months: {
            'Февраль, 2020': {
                total: 10,
                legend_v1: 23,
                legend_v2: 63,
                legend_v3: 6
            },
            'Март, 2020': {
                total: 7,
                legend_v1: 21,
                legend_v2: 35,
                legend_v3: 1
            },
            'Апрель, 2020': {
                total: 35,
                legend_v1: 22,
                legend_v2: 3,
                legend_v3: 0
            }
        }
    },
    5: {
        LTIFR: 0.8,
        stat_months: {
            'Май, 2020': {
                total: 9,
                legend_v1: 26,
                legend_v2: 15,
                legend_v3: 3
            },
            'Июнь, 2020': {
                total: 15,
                legend_v1: 27,
                legend_v2: 18,
                legend_v3: 10
            },
            'Июль, 2020': {
                total: 17,
                legend_v1: 20,
                legend_v2: 3,
                legend_v3: 1
            }
        }
    }
};

let data_map_footer_page = {
    murmansk: {
        count_days_ok: 12,
        LTIFR: 0.2,
        color: '#ff4a4a',
        title_company: 'Объединенное ПТУ Мурманска',
        text_company: 'Не следует, однако забывать, что сложившаяся структура организации представляет собой интересный эксперимент проверки новых предложений. Разнообразный и богатый опыт постоянное информационно-пропагандистское обеспечение нашей деятельности требуют определения и уточнения направлений прогрессивного развития. Разнообразный и богатый опыт сложившаяся структура организации позволяет оценить значение модели развития. Разнообразный и богатый опыт постоянный количественный рост и сфера нашей активности требуют от нас анализа дальнейших направлений развития. Товарищи! реализация намеченных плановых заданий позволяет выполнять важные задания по разработке позиций, занимаемых участниками в отношении поставленных задач. Товарищи! укрепление и развитие структуры в значительной степени обуславливает создание систем массового участия.',
        stat_years: {
            2020: {
                total: 35,
                legend_v1: 12,
                legend_v2: 7,
                legend_v3: 2
            },
            2019: {
                total: 27,
                legend_v1: 5,
                legend_v2: 2,
                legend_v3: 0
            },
            2018: {
                total: 43,
                legend_v1: 16,
                legend_v2: 14,
                legend_v3: 3
            },
            2017: {
                total: 31,
                legend_v1: 12,
                legend_v2: 10,
                legend_v3: 1
            }
        }
    },
    lelinck_kyznetskii: {
        count_days_ok: 25,
        LTIFR: 0.5,
        color: '#74b422',
        title_company: 'Объединенное ПТУ Ленинск-кузнецка',
        text_company: 'Разнообразный и богатый опыт консультация с широким активом требуют определения и уточнения системы обучения кадров, соответствует насущным потребностям. Таким образом постоянный количественный рост и сфера нашей активности требуют определения и уточнения дальнейших направлений развития. Идейные соображения высшего порядка, а также новая модель организационной деятельности требуют от нас анализа форм развития. Равным образом постоянное информационно-пропагандистское обеспечение нашей деятельности требуют определения и уточнения форм развития. Таким образом рамки и место обучения кадров представляет собой интересный эксперимент проверки направлений прогрессивного развития.',
        stat_years: {
            2020: {
                total: 45,
                legend_v1: 11,
                legend_v2: 6,
                legend_v3: 1
            },
            2019: {
                total: 30,
                legend_v1: 7,
                legend_v2: 3,
                legend_v3: 1
            },
            2018: {
                total: 20,
                legend_v1: 15,
                legend_v2: 10,
                legend_v3: 1
            },
            2017: {
                total: 23,
                legend_v1: 10,
                legend_v2: 8,
                legend_v3: 1
            }
        }
    },
    borodino: {
        count_days_ok: 25,
        LTIFR: 0.9,
        color: '#ff4a4a',
        title_company: 'Объединенное ПТУ Бородино',
        text_company: 'Идейные соображения высшего порядка, а также консультация с широким активом обеспечивает широкому кругу (специалистов) участие в формировании дальнейших направлений развития. С другой стороны рамки и место обучения кадров требуют определения и уточнения позиций, занимаемых участниками в отношении поставленных задач. Разнообразный и богатый опыт сложившаяся структура организации представляет собой интересный эксперимент проверки новых предложений.',
        stat_years: {
            2020: {
                total: 32,
                legend_v1: 15,
                legend_v2: 5,
                legend_v3: 2
            },
            2019: {
                total: 30,
                legend_v1: 11,
                legend_v2: 33,
                legend_v3: 2
            },
            2018: {
                total: 28,
                legend_v1: 14,
                legend_v2: 13,
                legend_v3: 1
            }
        }
    },
    sagan_nur: {
        count_days_ok: 17,
        LTIFR: 1.1,
        color: '#f6c358',
        title_company: 'Объединенное ПТУ Саган-Нур',
        text_company: 'Значимость этих проблем настолько очевидна, что начало повседневной работы по формированию позиции играет важную роль в формировании системы обучения кадров, соответствует насущным потребностям. Повседневная практика показывает, что укрепление и развитие структуры требуют от нас анализа позиций, занимаемых участниками в отношении поставленных задач. Таким образом новая модель организационной деятельности играет важную роль в формировании соответствующий условий активизации. Задача организации, в особенности же постоянное информационно-пропагандистское обеспечение нашей деятельности позволяет оценить значение модели развития.',
        stat_years: {
            2020: {
                total: 33,
                legend_v1: 6,
                legend_v2: 12,
                legend_v3: 3
            },
            2019: {
                total: 29,
                legend_v1: 9,
                legend_v2: 19,
                legend_v3: 7
            },
            2018: {
                total: 24,
                legend_v1: 11,
                legend_v2: 5,
                legend_v3: 0
            }
        }
    },
    chernogorsk: {
        count_days_ok: 15,
        LTIFR: 0.9,
        color: '#f6c358',
        title_company: 'Объединенное ПТУ Черногорск',
        text_company: 'С другой стороны новая модель организационной деятельности требуют от нас анализа дальнейших направлений развития. С другой стороны постоянный количественный рост и сфера нашей активности требуют определения и уточнения системы обучения кадров, соответствует насущным потребностям.',
        stat_years: {
            2020: {
                total: 22,
                legend_v1: 5,
                legend_v2: 7,
                legend_v3: 2
            },
            2019: {
                total: 27,
                legend_v1: 10,
                legend_v2: 7,
                legend_v3: 6
            },
            2018: {
                total: 26,
                legend_v1: 10,
                legend_v2: 9,
                legend_v3: 3
            }
        }
    },
    vanino: {
        count_days_ok: 13,
        LTIFR: 0.7,
        color: '#74b422',
        title_company: 'Объединенное ПТУ Ванино',
        text_company: ' Идейные соображения высшего порядка, а также новая модель организационной деятельности обеспечивает широкому кругу (специалистов) участие в формировании систем массового участия. Равным образом начало повседневной работы по формированию позиции играет важную роль в формировании систем массового участия. Задача организации, в особенности же постоянное информационно-пропагандистское обеспечение нашей деятельности требуют определения и уточнения существенных финансовых и административных условий. Не следует, однако забывать, что постоянный количественный рост и сфера нашей активности играет важную роль в формировании модели развития. ',
        stat_years: {
            2020: {
                total: 26,
                legend_v1: 9,
                legend_v2: 6,
                legend_v3: 1
            },
            2019: {
                total: 28,
                legend_v1: 10,
                legend_v2: 6,
                legend_v3: 0
            },
            2018: {
                total: 26,
                legend_v1: 10,
                legend_v2: 18,
                legend_v3: 0
            }
        }
    },
    naxodka: {
        count_days_ok: 13,
        LTIFR: 0.3,
        color: '#74b422',
        title_company: 'Объединенное ПТУ Находка',
        text_company: '  Идейные соображения высшего порядка, а также консультация с широким активом требуют определения и уточнения системы обучения кадров, соответствует насущным потребностям. Задача организации, в особенности же новая модель организационной деятельности позволяет выполнять важные задания по разработке новых предложений.',
        stat_years: {
            2020: {
                total: 20,
                legend_v1: 9,
                legend_v2: 5,
                legend_v3: 2
            },
            2019: {
                total: 22,
                legend_v1: 11,
                legend_v2: 1,
                legend_v3: 3
            },
            2018: {
                total: 33,
                legend_v1: 56,
                legend_v2: 25,
                legend_v3: 1
            }
        }
    }
};

let current_selected_sity_data = null;
let current_selected_division_data = null;

let hideAllsubMenu = function () {
    $('.header_content_top_menu_submenu_content').each(function () {
        $(this).hide();
    });
    $('.header_content_top_menu_inner > span > img').each(function () {
        $(this).attr('src', '/local/templates/suek.new/images/down-arrow.svg');
    });
}

let openSubMenu = function (dom_obj) {
    hideAllsubMenu();

    $(dom_obj).find('.header_content_top_menu_submenu_content').show();
    $(dom_obj).find('.header_content_top_menu_inner > span > img').attr('src', '/local/templates/suek.new/images/up-arrow.svg');
}

let showDownPopupMenu = function () {
    $('#footer_menu_popup').css('bottom', 0);
    $('#fade').show();
    $('#footer_menu_popup').show();
}

let uiUpdateStatFooterChart = function (value) {
    let item = current_selected_sity_data.stat_years[value];

    if (item === undefined) {
        return;
    }

    $('#header_content_circle_chart_2_inner_count_total').html(item.total);

    $('#safety_map_info_footer_legend_v1').html(item.legend_v1);
    $('#safety_map_info_footer_legend_v2').html(item.legend_v2);
    $('#safety_map_info_footer_legend_v3').html(item.legend_v3);

    if ($('#header_content_circle_chart_2').hasClass('listtopie-initialized')) {
        $('#header_content_circle_chart_2').listtopie('destroy');
    }

    $('#header_content_circle_chart_2').listtopie({
        size: 'auto',
        strokeWidth: 0,
        hoverEvent: false,
        speedDraw: 100,
        marginCenter: 60,
        listVal: false,
        strokeColor: '#fff',
        listValMouseOver: true,
        infoText: false,
        setValues: false,
        backColorOpacity: '0.8',
        hoverSectorColor: false,
        usePercent: false,
        startAngle: 270,
        dataJson: [{
            'name': 'Легкие травмы',
            'value': item.legend_v1,
            'color': '#FFDF07'
        }, {
            'name': 'Тяжелые травмы',
            'value': item.legend_v2,
            'color': '#F6C358'
        }, {
            'name': 'Летальный исход',
            'value': item.legend_v3,
            'color': '#D86363'
        }]
    });

}

let _uiUpdateFooterMapInfo = function (item) {

    current_selected_sity_data = item;

    $('.information-block .left .title span').html(item.title_company);
    $('.information-block .left .desc').html(item.text_company);
    $('#safety_info_map_obj_info_2_header_days_v').html(item.count_days_ok);

    $('#safety_info_map_obj_info_2_ltifr_v').css('color', item.color);
    $('#safety_info_map_obj_info_2_ltifr_v').html('LTIFR = ' + item.LTIFR);

    let list_years = [];
    for (var i in item.stat_years) {
        list_years.push(i);
    }

    list_years.sort().reverse();

    // update select drop down list
    $('#header_content_circle_chart_2_inner_month_year_select').empty();

    for (var v in list_years) {
        $('#header_content_circle_chart_2_inner_month_year_select').append($('<option></option>').attr('value', v).text(v));
    }

    setTimeout(function () {
        uiUpdateStatFooterChart(list_years[0]);
    }, 500);

    setTimeout(function () {

        __refreshAllStylesSelectList();

    }, 500);

}

let uiUpdateStatTopChart = function (value) {
    let item = current_selected_division_data.stat_months[value];

    if (item === undefined) {
        return;
    }

    $('#header_content_circle_chart_inner_count_total').html(item.total);

    $('#safety_map_info_top_legend_v1').html(item.legend_v1);
    $('#safety_map_info_top_legend_v2').html(item.legend_v2);
    $('#safety_map_info_top_legend_v3').html(item.legend_v3);

    $('#safety_map_info_popup_legend_v1').html(item.legend_v1);
    $('#safety_map_info_popup_legend_v2').html(item.legend_v2);
    $('#safety_map_info_popup_legend_v3').html(item.legend_v3);


    if ($('#header_content_circle_chart').hasClass('listtopie-initialized')) {
        $('#header_content_circle_chart').listtopie('destroy');
    }

    $('#header_content_circle_chart').listtopie({
        size: 'auto',
        strokeWidth: 0,
        hoverEvent: false,
        speedDraw: 100,
        marginCenter: 92,
        listVal: false,
        strokeColor: '#fff',
        listValMouseOver: true,
        infoText: false,
        setValues: false,
        backColorOpacity: '0.8',
        hoverSectorColor: false,
        usePercent: false,
        startAngle: 270,
        dataJson: [{
            'name': 'Легкие травмы',
            'value': item.legend_v1,
            'color': '#FFDF07'
        }, {
            'name': 'Тяжелые травмы',
            'value': item.legend_v2,
            'color': '#F6C358'
        }, {
            'name': 'Летальный исход',
            'value': item.legend_v3,
            'color': '#D86363'
        }]
    });
}

let uiUpdateTopInfo = function () {
    var division_value = $('#header_content_menu_division').val();
    current_selected_division_data = division_info_top[division_value];

    if (current_selected_division_data.LTIFR < 0.5) {
        $('#traffic_lights_digits_t1').css('opacity', 1);
        $('#traffic_lights_digits_t2').css('opacity', 0.2);
        $('#traffic_lights_digits_t3').css('opacity', 0.2);

        $('.traffic_lights svg #path3625').css('stroke', '#fff');
        $('.traffic_lights svg #ellipse879').css('stroke', '#4f5152');
        $('.traffic_lights svg #ellipse881').css('stroke', '#4f5152');
        $('.traffic_lights svg #path883').show();
        $('.traffic_lights svg #circle885').hide();
        $('.traffic_lights svg #circle887').hide();

    } else if (current_selected_division_data.LTIFR < 1) {
        $('#traffic_lights_digits_t1').css('opacity', 0.2);
        $('#traffic_lights_digits_t2').css('opacity', 1);
        $('#traffic_lights_digits_t3').css('opacity', 0.2);

        $('.traffic_lights svg #path3625').css('stroke', '#4f5152');
        $('.traffic_lights svg #ellipse881').css('stroke', '#4f5152');
        $('.traffic_lights svg #ellipse879').css('stroke', '#fff');
        $('.traffic_lights svg #path883').hide();
        $('.traffic_lights svg #circle887').hide();
        $('.traffic_lights svg #circle885').show();

    } else {
        $('#traffic_lights_digits_t1').css('opacity', 0.2);
        $('#traffic_lights_digits_t2').css('opacity', 0.2);
        $('#traffic_lights_digits_t3').css('opacity', 1);

        $('.traffic_lights svg #path3625').css('stroke', '#4f5152');
        $('.traffic_lights svg #ellipse879').css('stroke', '#4f5152');
        $('.traffic_lights svg #ellipse881').css('stroke', '#fff');
        $('.traffic_lights svg #path883').hide();
        $('.traffic_lights svg #circle885').hide();
        $('.traffic_lights svg #circle887').show();

    }

    $('#barometr_c_txt > span').html('LTIFR: ' + current_selected_division_data.LTIFR);

    let deg = 0;

    if (current_selected_division_data.LTIFR <= 1) {
        deg = -30 + (current_selected_division_data.LTIFR * 165 / 1);
    } else {
        deg = 135 + ((current_selected_division_data.LTIFR - 1.0) * 75);
    }

    $('#barometr_c_arrow').css('transform', 'rotate(' + deg + 'deg)');

    let stat_months = [];
    for (var i in current_selected_division_data.stat_months) {
        stat_months.push(i);
    }

    stat_months.sort().reverse();

    $('#header_content_menu_division_month_and_year').empty();

    for (var v in stat_months) {
        $('#header_content_menu_division_month_and_year').append($('<option></option>').attr('value', v).text(v));
    }

    setTimeout(function () {
        uiUpdateStatTopChart(stat_months[0]);
    }, 500);

    setTimeout(function () {

        __refreshAllStylesSelectList();

    }, 500);
}

let __refreshAllStylesSelectList = function () {
    $('#header_content_menu_division_month_and_year').trigger('refresh');
    $('#header_content_menu_division').trigger('refresh');
    $('#header_content_circle_chart_2_inner_month_year_select').trigger('refresh');
}

let initAllDivFunction = function () {
    down_menu.init($('#footer_menu_popup_drag_touch'), $('#footer_menu_popup'), function () {
        $('#fade').hide();
        $('#footer_menu_popup').hide();
        $('#footer_menu_popup').css('bottom', 0);
    });

    if (window.innerWidth <= 1024) {
        $('#header_stick_list').addClass('owl-carousel').owlCarousel({
            loop: false,
            margin: 0,
            items: 1,
            nav: false,
            dots: true,
            autoplay: false,
            // animateOut: 'fadeOut',
            mouseDrag: true,
            touchDrag: true
        });
    }

    $('#header_content_menu_division').styler();
    $('#safety_docs_tabs_select_drop_down_list select').styler();
    $('#header_content_circle_chart_inner_month_year select').styler();
    $('#header_content_circle_chart_2_inner_month_year select').styler();

    $('.map_block_rus_inner .list_city > div').click(function () {

        let sname = $(this).data('city-name');
        // console.log(sname);

        $('.maps_bb path').removeClass('active');

        switch (sname) {
            case 'vanino':
                $('.maps_bb path.vladivostok').addClass('active');
                break;
            case 'naxodka':
                $('.maps_bb path.vladivostok').addClass('active');
                break;
            case 'chernogorsk':
                $('.maps_bb path.abakan:first').addClass('active');
                break;
            case 'sagan_nur':
                $('.maps_bb path.ulan').addClass('active');
                break;
            case 'lelinck_kyznetskii':
                $('.maps_bb path.lelinck_kyznetskii').addClass('active');
                break;
            case 'borodino':
                $('.maps_bb path.krasnoyarsk').addClass('active');
                break;
            case 'nevinnomysk':
                $('.maps_bb path.nevinnomysk').addClass('active');
                break;
            case 'tuapse':
                $('.maps_bb path.tuapse').addClass('active');
                break;
            case 'ust-luga':
                $('.maps_bb path.ust-luga').addClass('active');
                break;
            default:
                break;
        }

    });

    uiUpdateTopInfo();


    $('#header_content_menu_division').on('change', function () {

        setTimeout(function () {

            uiUpdateTopInfo();

        }, 200);

        setTimeout(function () {

            __refreshAllStylesSelectList();

        }, 1000);

    });

    $('#header_content_menu_division_month_and_year').on('change', function () {

        let value = this.value;

        setTimeout(function () {

            uiUpdateStatTopChart(value);

        }, 200);

        setTimeout(function () {

            __refreshAllStylesSelectList();

        }, 1000);

    });

    $('#header_content_circle_chart_2_inner_month_year_select').on('change', function () {

        let value = this.value;

        setTimeout(function () {

            uiUpdateStatFooterChart(value);

        }, 200);

        setTimeout(function () {

            __refreshAllStylesSelectList();

        }, 500);

    });

    $('.safety_docs_tabs_header > div').click(function () {

        $('.safety_docs_tabs_header > div').each(function () {
            $(this).removeClass('safety_docs_tabs_header_current');
        });

        $(this).addClass('safety_docs_tabs_header_current');

    });

    $(document).bind('click', function () {
        hideAllsubMenu();
    });

    if ($(window).width() <= 947) {
        $('.safety_info_map_obj_info_2_toptip_info > button').attr('data-microtip-position', 'bottom-right');
    }

    let barometrValue = ($('#barometr') && $('#barometr').data('value'));
    if (typeof barometrValue === 'number') {

        barometrValue = Math.max(0, barometrValue);
        barometrValue = Math.min(2, barometrValue);

        var arrowAngle = -35;

        switch (true) {
            case barometrValue <= 0.5:
                arrowAngle = (83.33333333333333 * barometrValue * 2) - 35;
                break;
            case barometrValue <= 1:
                arrowAngle = (83.33333333333333 * (barometrValue - 0.5) * 2) + 83.33333333333333 - 35;
                break;
            default:
                arrowAngle = (83.33333333333333 * (barometrValue - 1)) + 83.33333333333333 + 83.33333333333333 - 35;
                break;
        }

        $('#barometr .barometr--arrow').css({
            'transform': 'rotate(' + arrowAngle + 'deg)'
        });

    }

};

if (typeof BX != 'undefined') {
    BX.ready(function () {
        openSubMenu();
        showDownPopupMenu();
        _uiUpdateFooterMapInfo();
    });
} else {
    $(function () {
        openSubMenu();
        showDownPopupMenu();
        _uiUpdateFooterMapInfo();
    });
}
